<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Normandy Trading House</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Cormorant+SC:wght@400;500;600;700&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --black:  #000000;
  --bg:     #060606;
  --card:   #0c0c0c;
  --border: rgba(180,150,80,0.18);
  --border2:rgba(180,150,80,0.42);
  --gold:   #C9A84C;
  --gold-d: rgba(201,168,76,0.08);
  --white:  #f0ece2;
  --w60:    rgba(240,236,226,0.60);
  --w30:    rgba(240,236,226,0.30);
  --w07:    rgba(240,236,226,0.07);
  --green:  #3dba6f;
  --green-d:rgba(61,186,111,0.10);
  --red:    #d94f4f;
  --serif:  'Cormorant Garamond', Georgia, serif;
  --sc:     'Cormorant SC', Georgia, serif;
  --mono:   'DM Mono', monospace;
  --sans:   'DM Sans', sans-serif;
  --ease:   cubic-bezier(0.16,1,0.3,1);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;}
body{
  background:var(--black); color:var(--white); font-family:var(--sans);
  min-height:100vh; display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  padding:40px 24px; -webkit-font-smoothing:antialiased; overflow-x:hidden;
}
body::before{
  content:''; position:fixed; inset:0;
  background-image:
    linear-gradient(rgba(201,168,76,0.025) 1px,transparent 1px),
    linear-gradient(90deg,rgba(201,168,76,0.025) 1px,transparent 1px);
  background-size:72px 72px; pointer-events:none; z-index:0;
}
.wrap{position:relative;z-index:1;width:100%;max-width:1020px;display:flex;flex-direction:column;align-items:center;}

/* ── top bar ── */
.topbar{
  position:fixed;top:0;left:0;right:0;
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 32px;
  background:rgba(0,0,0,0.85); backdrop-filter:blur(10px);
  border-bottom:1px solid var(--border);
  z-index:100;
  animation:fadeDown 0.5s var(--ease) both;
}
.tb-left{display:flex;align-items:center;gap:12px;}
.tb-crest img{width:28px;height:32px;filter:drop-shadow(0 2px 8px rgba(201,168,76,0.25));}
.tb-name{font-family:var(--sc);font-size:14px;font-weight:600;color:var(--gold);letter-spacing:0.08em;}
.tb-right{display:flex;align-items:center;gap:18px;}
.clock{font-family:var(--mono);font-size:11px;color:var(--w30);letter-spacing:0.08em;}
.live-ind{display:flex;align-items:center;gap:5px;font-family:var(--mono);font-size:9px;color:var(--w30);letter-spacing:0.1em;}
.live-dot{width:5px;height:5px;border-radius:50%;background:var(--green);animation:pulse 2s ease-in-out infinite;}
.live-dot.offline{background:var(--red);animation:none;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.2;}}

/* ── header ── */
.header{
  display:flex;flex-direction:column;align-items:center;
  text-align:center;margin-bottom:60px;margin-top:40px;
  animation:fadeUp 0.8s var(--ease) both;
}
.crest-wrap{margin-bottom:28px;position:relative;}
.crest-wrap::before{
  content:'';position:absolute;inset:-24px;border-radius:50%;
  background:radial-gradient(circle,rgba(201,168,76,0.12) 0%,transparent 70%);
  animation:breathe 4s ease-in-out infinite;
}
.crest-wrap img{
  width:84px;height:96px;display:block;position:relative;
  filter:drop-shadow(0 4px 28px rgba(201,168,76,0.35));
}
@keyframes breathe{0%,100%{transform:scale(1);opacity:0.7;}50%{transform:scale(1.07);opacity:1;}}
.house-name{font-family:var(--sc);font-size:clamp(26px,4vw,44px);font-weight:600;letter-spacing:0.1em;color:var(--gold);margin-bottom:10px;}
.house-sub{font-family:var(--sans);font-size:11px;font-weight:300;letter-spacing:0.2em;text-transform:uppercase;color:var(--w30);}

/* ── divider ── */
.divider{
  display:flex;align-items:center;gap:16px;width:100%;max-width:580px;
  margin-bottom:52px;animation:fadeUp 0.8s 0.1s var(--ease) both;
}
.div-line{flex:1;height:1px;background:var(--border);}
.div-diamond{width:6px;height:6px;background:var(--gold);transform:rotate(45deg);opacity:0.7;}
.div-text{font-family:var(--serif);font-style:italic;font-size:13px;color:var(--w30);white-space:nowrap;}

/* ── engine cards ── */
.engines{display:grid;grid-template-columns:1fr 1fr;gap:14px;width:100%;margin-bottom:48px;}

.engine-card{
  position:relative;display:flex;flex-direction:column;
  padding:44px 40px 36px;
  background:var(--card);border:1px solid var(--border);
  text-decoration:none;color:inherit;cursor:pointer;
  transition:border-color 0.35s var(--ease),transform 0.35s var(--ease),box-shadow 0.35s var(--ease);
  overflow:hidden;
}
.engine-card::before{
  content:'';position:absolute;inset:0;background:var(--gold-d);
  opacity:0;transition:opacity 0.35s var(--ease);
}
.engine-card:hover{
  border-color:var(--border2);transform:translateY(-4px);
  box-shadow:0 24px 64px rgba(0,0,0,0.7),0 0 0 1px rgba(201,168,76,0.10);
}
.engine-card:hover::before{opacity:1;}
.engine-card:nth-child(1){animation:fadeUp 0.8s 0.18s var(--ease) both;}
.engine-card:nth-child(2){animation:fadeUp 0.8s 0.26s var(--ease) both;}

/* gold accent bar on left */
.engine-card::after{
  content:'';position:absolute;left:0;top:20%;bottom:20%;width:1px;
  background:linear-gradient(to bottom,transparent,var(--gold),transparent);
  opacity:0;transition:opacity 0.4s var(--ease);
}
.engine-card:hover::after{opacity:0.5;}

.card-watermark{
  position:absolute;top:12px;right:24px;
  font-family:var(--sc);font-size:88px;font-weight:700;
  color:rgba(201,168,76,0.035);line-height:1;user-select:none;pointer-events:none;
}
.card-tag{
  font-family:var(--sans);font-size:10px;font-weight:500;
  letter-spacing:0.22em;text-transform:uppercase;color:var(--gold);
  margin-bottom:18px;display:flex;align-items:center;gap:8px;
}
.card-tag::before{content:'';display:inline-block;width:18px;height:1px;background:var(--gold);opacity:0.6;}
.card-title{font-family:var(--sc);font-size:clamp(22px,2.8vw,34px);font-weight:600;letter-spacing:0.04em;color:var(--white);line-height:1.15;margin-bottom:6px;}
.card-version{font-family:var(--serif);font-style:italic;font-size:14px;color:var(--gold);margin-bottom:18px;}

.card-status{display:flex;align-items:center;gap:7px;margin-bottom:24px;}
.status-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.status-dot.green{background:var(--green);box-shadow:0 0 8px var(--green);animation:pulse 2.4s ease-in-out infinite;}
.status-dot.gold{background:var(--gold);box-shadow:0 0 8px var(--gold);animation:pulse 2.4s ease-in-out infinite;}
.status-text{font-family:var(--mono);font-size:10px;font-weight:300;color:var(--w30);letter-spacing:0.1em;}

.card-desc{font-family:var(--sans);font-size:13px;font-weight:300;color:var(--w30);line-height:1.75;margin-bottom:30px;flex:1;}

/* stats strip */
.card-stats{
  display:grid;grid-template-columns:repeat(3,1fr);
  border-top:1px solid var(--border);padding-top:18px;margin-top:auto;
}
.stat-item{text-align:center;padding:0 4px;}
.stat-label{font-family:var(--sans);font-size:9px;font-weight:500;letter-spacing:0.14em;text-transform:uppercase;color:var(--w30);margin-bottom:6px;}
.stat-val{font-family:var(--mono);font-size:17px;font-weight:500;color:var(--white);line-height:1;}
.stat-val.pos{color:var(--green);}
.stat-val.neg{color:var(--red);}

.card-enter{
  position:absolute;bottom:34px;right:34px;
  font-family:var(--mono);font-size:11px;color:var(--gold);
  opacity:0;transform:translateX(-10px);
  transition:opacity 0.3s var(--ease),transform 0.3s var(--ease);
}
.engine-card:hover .card-enter{opacity:1;transform:translateX(0);}

/* ── combined balance bar ── */
.balance-bar{
  width:100%;display:flex;align-items:center;gap:0;
  border:1px solid var(--border);margin-bottom:48px;
  animation:fadeUp 0.8s 0.34s var(--ease) both;
}
.bal-cell{flex:1;padding:16px 24px;border-right:1px solid var(--border);}
.bal-cell:last-child{border-right:none;}
.bal-cell-label{font-family:var(--sans);font-size:9px;font-weight:500;letter-spacing:0.14em;text-transform:uppercase;color:var(--w30);margin-bottom:6px;}
.bal-cell-val{font-family:var(--mono);font-size:17px;font-weight:500;color:var(--white);}
.bal-cell-val.pos{color:var(--green);}
.bal-cell-val.neg{color:var(--red);}

/* ── footer ── */
.footer{
  font-family:var(--sans);font-size:11px;font-weight:300;
  color:var(--w30);letter-spacing:0.06em;text-align:center;
  animation:fadeUp 0.8s 0.38s var(--ease) both;
}
.footer span{color:var(--gold);opacity:0.7;}

@keyframes fadeUp  {from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeDown{from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}}

@media(max-width:740px){
  .engines{grid-template-columns:1fr;}
  .engine-card{padding:32px 28px 28px;}
  .balance-bar{flex-direction:column;}
  .bal-cell{border-right:none;border-bottom:1px solid var(--border);}
  .bal-cell:last-child{border-bottom:none;}
}
</style>
</head>
<body>

<header class="topbar">
  <div class="tb-left">
    <div class="tb-crest"><img src="crest.png" alt="crest"></div>
    <div class="tb-name">Normandy Trading House</div>
  </div>
  <div class="tb-right">
    <div class="clock" id="clock">--:--:-- UTC</div>
    <div class="live-ind"><div class="live-dot" id="live-dot"></div> LIVE</div>
  </div>
</header>

<div class="wrap">

  <header class="header">
    <div class="crest-wrap">
      <img src="crest.png" alt="Normandy Crest">
    </div>
    <div class="house-name">Normandy Trading House</div>
    <div class="house-sub">Proprietary Desk &nbsp;·&nbsp; Algo Monitor &nbsp;·&nbsp; Internal Only</div>
  </header>

  <!-- Combined balance -->
  <div class="balance-bar">
    <div class="bal-cell">
      <div class="bal-cell-label">Account Balance</div>
      <div class="bal-cell-val" id="bal-total">£—</div>
    </div>
    <div class="bal-cell">
      <div class="bal-cell-label">Daily P&amp;L</div>
      <div class="bal-cell-val" id="bal-pnl">—</div>
    </div>
    <div class="bal-cell">
      <div class="bal-cell-label">Combined Trades</div>
      <div class="bal-cell-val" id="bal-trades">—</div>
    </div>
    <div class="bal-cell">
      <div class="bal-cell-label">Open Positions</div>
      <div class="bal-cell-val" id="bal-open">—</div>
    </div>
  </div>

  <!-- Divider -->
  <div class="divider">
    <div class="div-line"></div>
    <div class="div-diamond"></div>
    <div class="div-text">Select engine dashboard</div>
    <div class="div-diamond"></div>
    <div class="div-line"></div>
  </div>

  <!-- Engine cards -->
  <div class="engines">

    <a class="engine-card" href="/trend">
      <div class="card-watermark">I</div>
      <div class="card-tag">Engine One</div>
      <div class="card-title">Trend Engine</div>
      <div class="card-version">Deterministic V1.4</div>
      <div class="card-status">
        <div class="status-dot green"></div>
        <span class="status-text" id="trend-status">connecting...</span>
      </div>
      <div class="card-desc">
        Session-filtered momentum execution across six assets. Dist-from-high bounce and breakout signals gated by tide speed VOL%.
      </div>
      <div class="card-stats">
        <div class="stat-item">
          <div class="stat-label">Trades</div>
          <div class="stat-val" id="t-trades">—</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Win Rate</div>
          <div class="stat-val" id="t-wr">—</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Session P&amp;L</div>
          <div class="stat-val" id="t-pnl">—</div>
        </div>
      </div>
      <div class="card-enter">Open →</div>
    </a>

    <a class="engine-card" href="/structure">
      <div class="card-watermark">II</div>
      <div class="card-tag">Engine Two</div>
      <div class="card-title">Structure Engine</div>
      <div class="card-version">Tidal V1.0</div>
      <div class="card-status">
        <div class="status-dot gold"></div>
        <span class="status-text" id="structure-status">connecting...</span>
      </div>
      <div class="card-desc">
        24/5 range-touch and breakout mean reversion. Price oscillates away from and back to its rolling range extreme — tidal cycle logic.
      </div>
      <div class="card-stats">
        <div class="stat-item">
          <div class="stat-label">Trades</div>
          <div class="stat-val" id="s-trades">—</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Win Rate</div>
          <div class="stat-val" id="s-wr">—</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Session P&amp;L</div>
          <div class="stat-val" id="s-pnl">—</div>
        </div>
      </div>
      <div class="card-enter">Open →</div>
    </a>

  </div>

  <div class="footer">
    Private dashboard &nbsp;<span>·</span>&nbsp; Not for public distribution &nbsp;<span>·</span>&nbsp; Normandy Trading House
  </div>

</div>

<script>
const IS_LOCAL = window.location.port === '5050' && window.location.hostname === 'localhost';
const API_URL  = IS_LOCAL ? '/api/status' : './status.json';

function pad(n){return String(n).padStart(2,'0');}
function tickClock(){
  const n=new Date();
  document.getElementById('clock').textContent=`${pad(n.getUTCHours())}:${pad(n.getUTCMinutes())}:${pad(n.getUTCSeconds())} UTC`;
}
tickClock(); setInterval(tickClock,1000);

function fmtGBP(v){
  if(typeof v!=='number') return '—';
  return (v>=0?'+£':'-£')+Math.abs(v).toFixed(2);
}
function fmtPct(v,dp=2){
  if(typeof v!=='number') return '—';
  return (v>=0?'+':'')+v.toFixed(dp)+'%';
}

async function poll(){
  try{
    const res=await fetch(API_URL,{cache:'no-store'});
    const d=await res.json();

    // Balance bar
    const bal=d.balance||{};
    const b=document.getElementById('bal-total');
    if(b) b.textContent='£'+(bal.balance||0).toLocaleString('en-GB',{minimumFractionDigits:2});
    const bp=document.getElementById('bal-pnl');
    if(bp){
      bp.textContent=fmtGBP(bal.daily_pnl);
      bp.className='bal-cell-val '+(bal.daily_pnl>=0?'pos':'neg');
    }
    const bt=document.getElementById('bal-trades');
    if(bt) bt.textContent=(d.analytics?.total_trades||0)+' closed';
    const bo=document.getElementById('bal-open');
    if(bo){
      const n=Object.keys(d.open_positions||{}).length;
      bo.textContent=n===0?'None':n+' open';
      bo.className='bal-cell-val '+(n>0?'pos':'');
    }

    // Trend card
    const ta=d.trend_analytics||{};
    document.getElementById('t-trades').textContent=ta.total_trades||'0';
    document.getElementById('t-wr').textContent=ta.total_trades?ta.win_rate.toFixed(1)+'%':'—';
    const tpnl=document.getElementById('t-pnl');
    tpnl.textContent=ta.total_trades?fmtGBP(ta.total_pnl):'—';
    tpnl.className='stat-val '+(typeof ta.total_pnl==='number'?(ta.total_pnl>=0?'pos':'neg'):'');
    document.getElementById('trend-status').textContent=
      ta.total_trades>0?`${ta.total_trades} trades · active`:'live · no trades yet';

    // Structure card
    const sa=d.structure_analytics||{};
    document.getElementById('s-trades').textContent=sa.total_trades||'0';
    document.getElementById('s-wr').textContent=sa.total_trades?sa.win_rate.toFixed(1)+'%':'—';
    const spnl=document.getElementById('s-pnl');
    spnl.textContent=sa.total_trades?fmtGBP(sa.total_pnl):'—';
    spnl.className='stat-val '+(typeof sa.total_pnl==='number'?(sa.total_pnl>=0?'pos':'neg'):'');
    document.getElementById('structure-status').textContent=
      sa.total_trades>0?`${sa.total_trades} trades · active`:'live · no trades yet';

    document.getElementById('live-dot').className='live-dot';
  } catch(e){
    document.getElementById('live-dot').className='live-dot offline';
    ['trend-status','structure-status'].forEach(id=>{
      const el=document.getElementById(id); if(el) el.textContent='server offline';
    });
  }
}
poll(); setInterval(poll,5000);
</script>
</body>
</html>
